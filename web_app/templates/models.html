<!doctype html>
<html>
<head>
    <title>INIDS - Model Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-5.2.3-dist/css/bootstrap.min.css') }}">
    <style>
        body { background-color: #f8f9fa; }
        .main-box {
            background: #fff;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        .metric-card {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #e3e7ee;
            background: #fff;
        }
        .best-model { border: 3px solid #28a745; background-color: #d4edda; }
        .table-wrap {
            max-height: 280px;
            overflow: auto;
        }
        .chart-box {
            border: 1px solid #e7ebf0;
            border-radius: 12px;
            background: #f9fbfe;
            padding: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">INIDS</a>
            <div>
                <a href="/predict" class="btn btn-outline-light btn-sm">Predict</a>
                <a href="/dashboard" class="btn btn-outline-light btn-sm">Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="main-box">
            <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Machine Learning Models Comparison</h2>
                {% if latest_results %}
                <small class="text-muted">Source: {{ latest_results }}</small>
                {% endif %}
            </div>

            {% if has_data and models %}
            <div class="row">
                {% for model in models %}
                {% set accuracy = model.get('accuracy', 0) %}
                {% set precision = model.get('precision', accuracy) %}
                {% set recall = model.get('recall', accuracy) %}
                {% set f1_score = model.get('f1_score', 0) %}
                {% set training_time = model.get('training_time', 0) %}
                <div class="col-md-6 mb-3">
                    <div class="card metric-card {% if loop.first %}best-model{% endif %}">
                        <div class="card-body">
                            <h5 class="card-title">
                                {{ model.get('name', 'Unnamed Model')|replace('_', ' ')|title }}
                                {% if loop.first %}<span class="badge bg-success">Best</span>{% endif %}
                            </h5>
                            <hr>
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Accuracy:</strong> {{ "%.2f"|format(accuracy * 100) }}%</p>
                                    <p><strong>Precision:</strong> {{ "%.2f"|format(precision * 100) }}%</p>
                                </div>
                                <div class="col-6">
                                    <p><strong>Recall:</strong> {{ "%.2f"|format(recall * 100) }}%</p>
                                    <p><strong>F1-Score:</strong> {{ "%.4f"|format(f1_score) }}</p>
                                </div>
                            </div>
                            <p class="text-muted mb-0">
                                <small>Training time: {{ "%.2f"|format(training_time) }}s</small>
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="mt-4">
                <h4 class="mb-3">Performance Visualizations</h4>
                {% if chart_files.model_comparison %}
                <div class="chart-box text-center">
                    <img src="{{ url_for('static', filename='model_comparison.png') }}"
                         class="img-fluid" style="max-width:900px;" alt="Model Comparison">
                </div>
                {% endif %}
                {% if chart_files.training_time_comparison %}
                <div class="chart-box text-center">
                    <img src="{{ url_for('static', filename='training_time_comparison.png') }}"
                         class="img-fluid" style="max-width:900px;" alt="Training Time Comparison">
                </div>
                {% endif %}
                {% if chart_files.roc_curves %}
                <div class="chart-box text-center">
                    <img src="{{ url_for('static', filename='roc_curves.png') }}"
                         class="img-fluid" style="max-width:900px;" alt="ROC Curves">
                </div>
                {% endif %}
                {% if not chart_files.model_comparison and not chart_files.training_time_comparison and not chart_files.roc_curves %}
                <div class="alert alert-info mb-0">
                    No chart images found yet. Train models to generate visualization artifacts.
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="alert alert-warning mb-4">
                No model comparison results found. Run <code>python -m src.train_cli --suite full --include-multiclass</code>.
            </div>
            {% endif %}

            <div>
                <h4 class="mb-3">Recent Registry Entries</h4>
                {% if registry_entries %}
                <div class="table-wrap">
                    <table class="table table-striped table-bordered table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Accuracy</th>
                                <th>F1</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in registry_entries %}
                            <tr>
                                <td>{{ entry.name }}</td>
                                <td>{{ "%.2f"|format(entry.accuracy * 100) }}%</td>
                                <td>{{ "%.4f"|format(entry.f1_score) }}</td>
                                <td>{{ entry.created_at }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No registry entries available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
